<div>
  <h2>Consultar Solicitudes</h2>
  <p><em>Los estados muestran el avance de la validación realizada por asistentes IA en cada dimensión.</em></p>
  <form (submit)="searchSolicitudes()" style="display: flex; gap: 10px; flex-wrap: wrap;">
    <input type="text" [(ngModel)]="searchProveedor" placeholder="Proveedor" style="flex:1;">
    <input type="text" [(ngModel)]="searchNIT" placeholder="NIT" style="flex:1;">
    <input type="date" [(ngModel)]="searchFecha" style="flex:1;">
    <button type="submit" class="btn">Buscar</button>
  </form>

  <table *ngIf="solicitudes.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Código Proyecto</th>
        <th>Proveedor</th>
        <th>NIT</th>
        <th>Fecha</th>
        <th>Estado</th>
        <th>Dimensiones</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let solicitud of solicitudesFiltradas">
        <td>{{ solicitud.SolicitudID }}</td>
        <td>{{ solicitud.CodigoProyecto }}</td>
        <td>{{ solicitud.ProveedorNombre }}</td>
        <td>{{ solicitud.ProveedorNIT }}</td>
        <td>{{ solicitud.FechaCreacion | date:'short' }}</td>
        <td>{{ solicitud.EstadoGeneral }}</td>
        <td>
          <div class="dimension-status">
            <span class="status" [ngClass]="{'pending': solicitud.Estado.economica === 'pending', 'done': solicitud.Estado.economica === 'done'}">Económica</span>
            <span class="status" [ngClass]="{'pending': solicitud.Estado.social === 'pending', 'done': solicitud.Estado.social === 'done'}">Social</span>
            <span class="status" [ngClass]="{'pending': solicitud.Estado.ambiental === 'pending', 'done': solicitud.Estado.ambiental === 'done'}">Ambiental</span>
          </div>
        </td>
        <td class="status" [ngClass]="solicitud.EstadoGeneral">{{ solicitud.EstadoGeneral }}</td>
        <td>
          <a (click)="verInforme(solicitud.SolicitudID)" class="btn">Ver Informe</a>
          <button (click)="eliminarSolicitud(solicitud.SolicitudID)" class="btn btn-danger" style="margin-left:8px;">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>
  <p *ngIf="solicitudes.length === 0">No se encontraron solicitudes.</p>
</div>
<!-- Agrega esto al final de tu estado.component.html -->
<div *ngIf="informeVisible" class="modal">
  <div class="modal-content informe-modal">
    <span class="close" (click)="cerrarInforme()">&times;</span>
    <h2>Informe de Solicitud</h2>
    <div class="tabs">
      <button [class.active]="informeTab==='resumen'" (click)="informeTab='resumen'">Resumen</button>
      <button [class.active]="informeTab==='ambiental'" (click)="informeTab='ambiental'">Ambiental</button>
      <button [class.active]="informeTab==='social'" (click)="informeTab='social'">Social</button>
      <button [class.active]="informeTab==='economica'" (click)="informeTab='economica'">Económica</button>
      <button [class.active]="informeTab==='reporte'" (click)="informeTab='reporte'">Reporte</button>
    </div>
    <div *ngIf="informeTab==='resumen'">
      <table class="info-table">
        <tr><th>Código Proyecto</th><td>{{informeData.CodigoProyecto}}</td></tr>
        <tr><th>Proveedor</th><td>{{informeData.ProveedorNombre}}</td></tr>
        <tr><th>NIT</th><td>{{informeData.ProveedorNIT}}</td></tr>
        <tr><th>Fecha Creación</th><td>{{informeData.FechaCreacion | date:'medium'}}</td></tr>
        <tr><th>Estado General</th><td>{{informeData.EstadoGeneral}}</td></tr>
        <tr><th>Usuario Solicitante</th><td>{{informeData.UsuarioSolicitante}}</td></tr>
        <tr><th>Archivo Excel</th><td>{{informeData.FuenteExcelPath}}</td></tr>
        <tr><th>Anexos</th><td>
          <ul>
            <li *ngFor="let anexo of informeData.Anexos">{{anexo.filename}}</li>
          </ul>
        </td></tr>
        <tr>
          <th>Estado Dimensiones</th>
          <td>
            <span class="badge ambiental" [class.done]="informeData.Estado?.ambiental==='done'">Ambiental</span>
            <span class="badge social" [class.done]="informeData.Estado?.social==='done'">Social</span>
            <span class="badge economica" [class.done]="informeData.Estado?.economica==='done'">Económica</span>
          </td>
        </tr>
      </table>
    </div>
    <div *ngIf="informeTab==='ambiental'">
      <h3>Evaluación Ambiental</h3>
      
      <div *ngFor="let eval of informeData.EvaluacionAmbiental">
        <div *ngIf="eval.required_action">
          <div *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <div *ngIf="call.function">
              <!-- Mejora la visualización de cada revisión en las pestañas ambiental, social y económica -->
              <div *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <div class="pregunta-panel">
                  <!-- Pregunta destacada -->
                  <div class="pregunta-box">
                    <strong>{{rev.pregunta}}</strong>
                  </div>
                  <!-- Respuesta y puntaje proveedor -->
                  <div class="respuesta-box">
                    <span><b>Respuesta:</b> {{rev.respuesta_proveedor}}</span>
                    <span class="puntaje-proveedor"><b>Puntaje Proveedor:</b> {{rev.Puntaje_respuesta_proveedor}}</span>
                  </div>
                  <!-- Resultado del análisis IA -->
                  <div class="analisis-box">
                    <span><b>Puntaje Asistente:</b> {{rev.Puntaje_respuesta_asistente}}</span>
                    <span><b>Resultado:</b> {{rev.resultado_por_pregunta}}</span>
                    <span><b>Sugerencia:</b> <em>{{rev.sugerencia}}</em></span>
                    <span><b>Observaciones:</b> {{rev.observaciones_internas}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <span><b>{{informeData.RespuestaAmbiental}}</b></span>
    </div>
    <div *ngIf="informeTab==='social'">
      <h3>Evaluación Social</h3>
      
      <div *ngFor="let eval of informeData.EvaluacionSocial">
        <div *ngIf="eval.required_action">
          <div *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <div *ngIf="call.function">
              <!-- Mejora la visualización de cada revisión en las pestañas ambiental, social y económica -->
              <div *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <div class="pregunta-panel">
                  <!-- Pregunta destacada -->
                  <div class="pregunta-box">
                    <strong>{{rev.pregunta}}</strong>
                  </div>
                  <!-- Respuesta y puntaje proveedor -->
                  <div class="respuesta-box">
                    <span><b>Respuesta:</b> {{rev.respuesta_proveedor}}</span>
                    <span class="puntaje-proveedor"><b>Puntaje Proveedor:</b> {{rev.Puntaje_respuesta_proveedor}}</span>
                  </div>
                  <!-- Resultado del análisis IA -->
                  <div class="analisis-box">
                    <span><b>Puntaje Asistente:</b> {{rev.Puntaje_respuesta_asistente}}</span>
                    <span><b>Resultado:</b> {{rev.resultado_por_pregunta}}</span>
                    <span><b>Sugerencia:</b> <em>{{rev.sugerencia}}</em></span>
                    <span><b>Observaciones:</b> {{rev.observaciones_internas}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <span><b>{{informeData.RespuestaSocial}}</b></span>
    </div>
    <div *ngIf="informeTab==='economica'">
      <h3>Evaluación Económica</h3>
      
      <div *ngFor="let eval of informeData.EvaluacionEconomica">
        <div *ngIf="eval.required_action">
          <div *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <div *ngIf="call.function">
              <!-- Mejora la visualización de cada revisión en las pestañas ambiental, social y económica -->
              <div *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <div class="pregunta-panel">
                  <!-- Pregunta destacada -->
                  <div class="pregunta-box">
                    <strong>{{rev.pregunta}}</strong>
                  </div>
                  <!-- Respuesta y puntaje proveedor -->
                  <div class="respuesta-box">
                    <span><b>Respuesta:</b> {{rev.respuesta_proveedor}}</span>
                    <span class="puntaje-proveedor"><b>Puntaje Proveedor:</b> {{rev.Puntaje_respuesta_proveedor}}</span>
                  </div>
                  <!-- Resultado del análisis IA -->
                  <div class="analisis-box">
                    <span><b>Puntaje Asistente:</b> {{rev.Puntaje_respuesta_asistente}}</span>
                    <span><b>Resultado:</b> {{rev.resultado_por_pregunta}}</span>
                    <span><b>Sugerencia:</b> <em>{{rev.sugerencia}}</em></span>
                    <span><b>Observaciones:</b> {{rev.observaciones_internas}}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <span><b>{{informeData.RespuestaEconomica}}</b></span>
    </div>
    <!-- Nueva sección Reporte -->
<div *ngIf="informeTab==='reporte'" id="reporte-consolidado">
  <img src="assets/logo.png" alt="SostenIA" class="asistente-img">
  <img src="https://images.ctfassets.net/xysarnlrhe1d/4KaYTIvy6xOJJBHMqu6YSc/fa061f032abbb51d9dbb9463a4afc3a0/logocomfama1.png?w=196&h=36&q=50&fm=webp" alt="Logo Comfama">
  <h3>Reporte Consolidado de Evaluación</h3>
  <button class="btn" (click)="imprimirReporte()">Imprimir PDF</button>
  <table class="info-table">
    <thead>
      <tr>
        <th>Dimensión</th>
        <th>Criterio</th>
        <th>Pregunta</th>
        <th>Respuesta Proveedor</th>
        <th>Puntaje Proveedor</th>
        <th>Puntaje Asistente</th>
        <th>Resultado</th>
        <th>Sugerencia</th>
        <th>Observaciones</th>
      </tr>
    </thead>
    <tbody>
      <!-- Ambiental -->
      <ng-container *ngFor="let eval of informeData.EvaluacionAmbiental">
        <ng-container *ngIf="eval.required_action">
          <ng-container *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <ng-container *ngIf="call.function">
              <tr *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <td>Ambiental</td>
                <td>{{rev.criterio}}</td>
                <td>{{rev.pregunta}}</td>
                <td>{{rev.respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_asistente}}</td>
                <td>{{rev.resultado_por_pregunta}}</td>
                <td><em>{{rev.sugerencia}}</em></td>
                <td>{{rev.observaciones_internas}}</td>
              </tr>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
      <!-- Social -->
      <ng-container *ngFor="let eval of informeData.EvaluacionSocial">
        <ng-container *ngIf="eval.required_action">
          <ng-container *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <ng-container *ngIf="call.function">
              <tr *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <td>Social</td>
                <td>{{rev.criterio}}</td>
                <td>{{rev.pregunta}}</td>
                <td>{{rev.respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_asistente}}</td>
                <td>{{rev.resultado_por_pregunta}}</td>
                <td><em>{{rev.sugerencia}}</em></td>
                <td>{{rev.observaciones_internas}}</td>
              </tr>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
      <!-- Económica -->
      <ng-container *ngFor="let eval of informeData.EvaluacionEconomica">
        <ng-container *ngIf="eval.required_action">
          <ng-container *ngFor="let call of eval.required_action.submit_tool_outputs.tool_calls">
            <ng-container *ngIf="call.function">
              <tr *ngFor="let rev of (call.function.arguments | parseRevisiones)">
                <td>Económica</td>
                <td>{{rev.criterio}}</td>
                <td>{{rev.pregunta}}</td>
                <td>{{rev.respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_proveedor}}</td>
                <td>{{rev.Puntaje_respuesta_asistente}}</td>
                <td>{{rev.resultado_por_pregunta}}</td>
                <td><em>{{rev.sugerencia}}</em></td>
                <td>{{rev.observaciones_internas}}</td>
              </tr>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
  <h3>Analisis Ambiental:</h3>
  <span><b>{{informeData.RespuestaAmbiental}}</b></span>
  <h3>Analisis Social:</h3>
  <span><b>{{informeData.RespuestaSocial}}</b></span>
  <h3>Analisis Economico:</h3>
  <span><b>{{informeData.RespuestaEconomica}}</b></span>
</div>
<!-- ...existing code... -->
  </div>
</div>